<?xml version = "1.0" encoding = "utf-8"?>

<html>
	<head>
		<title> Drag and drop </title>
 		<link rel="stylesheet" type="text/css" href="./jigsaw.css" />
		<script type="text/javascript" src = "./jigsaw.js"></script>
		<script type="text/javascript">
			var imDirPaths, imageArray, imFileNames, canvas, context;
				

			function getRow(n) {
				var row = Math.floor((n / 4));
				return row;
			}

			function getColumn(n) {
				var column = n % 4;
				return column;
			}
		
			function getImageNum(imStr) {
				var dotIdx = imStr.lastIndexOf(".");
				var imNum = imStr.charAt(dotIdx - 1);
				if(imNum == 0 || imNum == 1 || imNum == 2) {
					var tenPlace = imStr.charAt(dotIdx - 2);
					if(tenPlace == 1) {
						if(imNum == 0) {
							imNum = 10;
						} else if(imNum == 1) {
							imNum = 11;
						} else {
							imNum = 12;
						}
					}
				}
				return imNum;
			}	

			function getRandFileNames() {
				var randIdx = Math.random() * 3;
				randIdx = Math.floor(randIdx);
				var rplus = randIdx + 1;
				var randStr = rplus.toString();
				var imString = new String();
				for(var i = 0; i < 12; ++i) {
					var iSt = new String((i + 1));
					imString = imDirPaths[randIdx];
					imString += "img" + randStr + "-" + iSt + ".jpg";
					imFileNames[i] = imString;
				}
			}

			function placeImage(img, x0, y0, x1, y1) {
				var x0 = img.x;
				var y0 = img.y;
				var x1 = x0 + img.width;
				var y1 = y1 + img.height;

				context.drawImage(img, x0, y0, x1, y1);
//				document.getElementById("testArea").innerHTML += "x0, y0, x1, y1: " + x0 + " " + y0 + " " + x1 + " " + y1 + "<br>";

//				context.drawImage(img, x0, y0, img.width, img.height);
			}
		
		/*	function createNewImage(imSrc) {
				var imNum = getImageNum(imSrc);
				var n = new Number(imNum);
				n = n - 1;
				var row = Math.floor(n / 4);
				var col = n % 4;
				var width = 100;
				var height = 100;
				var xCoord = (col * width);
				var yCoord = (row * height);

				document.getElementById("testArea").innerHTML += "xCoord: " + xCoord + " yCoord: " + yCoord + "<br>";
				var imId = "im_" + imNum.toString();
				var img = new Image();
				img.type = "image";
				img.name = imNum.toString();
				img.id = imId;
				img.src = imSrc;
				img.row = row;
				img.column = col;	
				img.x = xCoord;
				img.y = yCoord;
				img.width = width;
				img.height = height;
				img.draggable = true;
				img.onmousedown = "grabber(event);";
				img.onload = function() {
					placeImage( img );		
				}	
				return img;
			}*/
			

/*
			 function createNewImage(imSrc, imRow, imCol) {
        
// 				var imNum = getImageNum(imSrc);
//        var n = new Number(imNum);
//        n = n - 1;
//       var row = Math.floor(n / 4);
//        var col = n % 4;
//        var imId = "im_" + imNum.toString();
        var img = new Image();
//				img.n = n;
        img.type = "image";
        img.src = imSrc;
        img.row = imRow;
        img.col = imCol; 
        img.x = img.col * 100;
        img.y = img.row * 100;
        img.width = 100;
        img.height = 100;
				var x1 = img.x + img.width;
				var y1 = img.y + img.height;
				 document.getElementById("testArea").innerHTML += "x0, y0, x1, y1: " + img.x + " " + img.y + " " + x1 + " " + y1  + "<br>";


        img.onmousedown = "grabber(event);";
        img.onload = function() {
          placeImage( img, img.x, img.y, x1, y1);    
        } 
        return img;
      }
*/

			function createNewImage(imSrc, imRow, imCol) {
				var lLeft = new Point2D(imCol * 100, imRow * 100);
				var uRight = new Point2D((imCol + 1) * 100, (imRow + 1) * 100);
				var idx = imRow * 4 + imCol;
				imageArray[idx] = new Image();
				imageArray[idx].lower_left = lLeft;
				imageArray[idx].upper_right = uRight;
				imageArray[idx].onload = function() {
					context.drawImage(imageArray[idx], lLeft.x, lLeft.y, (uRight.x - lLeft.x), (uRight.y - lLeft.y));
		
				};
				
				imageArray[idx].src = imSrc;
			}

			function loadImages() {
				getRandFileNames();
				for(var row = 0; row < 3; ++row) {
					for(var col = 0; col < 4; ++col) {
						var idx = row * 4 + col;
//						imageArray[idx] = createNewImage(imFileNames[idx], row, col);
							createNewImage(imFileNames[idx], row, col);
					}
				}
//				for(var i = 0; i < 12; ++i) {
//					var row = Math.floor((i / 4));
//					var col = i % 4;
//					imageArray[i] = createNewImage(imFileNames[i], row, col);
//				}
			}

			function init() {
				canvas = document.getElementById("myCanvas");
				context = canvas.getContext('2d');

				imDirPaths = new Array(3);
				imDirPaths[0] = "./Images/images1/";
				imDirPaths[1] = "./Images/images2/";
				imDirPaths[2] = "./Images/images3/";
				
				imageArray = new Array(12);
				imFileNames = new Array(12);

				loadImages();
			}
		</script>
	</head>

	<body onload="init()">
		<div id="content">
			<canvas id="myCanvas">Your browser does not suppor Canvas</canvas>
			<br>
			<p id="testArea">put stuff here</p>
		</div>
	</body>
</html>
